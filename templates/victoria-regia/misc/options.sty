\usepackage{ifxetex}
\ifxetex
  \usepackage[
    activate={true,nocompatibility},
    final,
    tracking=false,
    kerning=true,
    spacing=false
  ]{microtype}   % Enhances typographic quality (limited for xelatex)
\else
  \usepackage[
    activate={true,nocompatibility},
    final,
    tracking=true,
    kerning=true,
    spacing=true,
    factor=1100,
    stretch=10,
    shrink=10
  ]{microtype}   % Enhances typographic quality (full features for pdflatex)
\fi

% LANGUAGE TRANSLATIONS ------------------------------------------------------------------
\usepackage[italian]{babel} % Language and hyphenation rules for Italian
\addto\captionsitalian{\renewcommand{\contentsname}{Contenuto}} % Customize the table of contents title
% LANGUAGE TRANSLATIONS ------------------------------------------------------------------

%\usepackage{mathpazo}
%\linespread{1.1}

\usepackage{lettrine}   % Enables dropped capital letters at the beginning of chapters
\usepackage{graphicx}   % Standard package for including graphics
\usepackage{xcolor}     % Enables custom color definitions
\usepackage{xstring}    % String comparison functions
% \usepackage{ebgaramond} % EB Garamond font - not available in GitHub Actions
\usepackage{mathpazo}   % Palatino font as fallback
\linespread{1.1}
\usepackage{tikz}       % Powerful vector drawing library
\usetikzlibrary{math,positioning,shadows.blur} % TikZ sublibraries
\usepackage{url}
\usepackage{hyperref}   % Enables hyperlinks and cross-references
\usepackage{pgfornament}

\newcommand{\hsp}{\kern 1pt}    % Custom command for fine-tuning spacing in nested quotation marks

% Paragraph formatting settings
\renewcommand{\baselinestretch}{1.125}      % Increases line spacing for improved readability
\setlength{\parskip}{0pt}                   % Disables additional vertical spacing between paragraphs
\setlength{\parindent}{1em}                 % Sets standard paragraph indentation

% Sentence spacing (prevents extra space after periods)
\frenchspacing

% Avoid widows and orphans in text layout
\widowpenalty=10000
\clubpenalty=10000

% Relax overfull hbox warnings by allowing flexible spacing
\sloppy

% Table of contents customization
\usepackage[titles]{tocloft}
\renewcommand{\cftchapfont}{\large\itshape}       % Chapter titles in TOC: large italic
\renewcommand{\cftchappagefont}{\normalfont}      % Page numbers in TOC: normal font
\renewcommand{\numberline}[1]{}                   % Remove chapter numbers in TOC

% Chapter heading customization
\usepackage[center,sc]{titlesec} % Chapter titles: centered and small caps

% Roman numerals for chapter numbers
\renewcommand{\thechapter}{\Roman{chapter}}

% Define chapter title format
\titleformat{\chapter}[block]
  {\normalfont\scshape\huge\centering}
  {\thechapter\\}
  {0pt}
  {}
\titlespacing*{\chapter}{0pt}{0pt}{1em}
\makeatletter
\renewcommand{\@makechapterhead}[1]{%
  \vspace*{50pt}
  {\parindent \z@ \centering \normalfont
    \scshape \huge
    \ifnum\c@chapter>0
    \thechapter \par {#1}\par\nobreak
    \vspace{0.5em}
    \pgfornament[width=5cm]{85}\par
    \vspace{1.5em}
    \else
      #1\par\nobreak
      \vspace{1em}
    \fi
  }}
\makeatother

% Header and footer settings
\usepackage{fancyhdr}
\setlength{\headheight}{15pt}
\pagestyle{fancy}
\fancyhf{} % Clear all header and footer fields

\renewcommand{\headrulewidth}{0pt} % Remove header rule line

\fancyhf[CFE,CFO]{\thepage}        % Page number centered in footer (even and odd pages)
%\fancyhead[LE,RO]{\thepage}       % Alternative page numbering in header corners
\fancyhead[CE]{\itshape\authorname} % Author name centered on even-page headers
\fancyhead[CO]{\itshape\booktitle}  % Book title centered on odd-page headers

% Custom color definitions
\definecolor{customgold}{RGB}{203,161,53}   % Define a gold tone for accent use
\definecolor{darkmagenta}{RGB}{139, 0, 139}
\definecolor{ultradarkmagenta}{RGB}{50, 0, 50}
